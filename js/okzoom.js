$(function(o){var e=function(t){t=t.toLowerCase();var i=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[],n={browser:i[1]||"",version:i[2]||"0"};return e={},n.browser&&(e[n.browser]=!0,e.version=n.version),e.chrome?e.webkit=!0:e.webkit&&(e.safari=!0),window.$&&(o.browser=e),e}(navigator.userAgent),t=navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i),i=navigator.userAgent.match(/iPad/i),n=navigator.userAgent.match(/Android/i),a=t||i||n,r=e.safari?"WebkitTransition":"transition",s=e.safari?"WebkitTransform":"transform",l=e.safari?"-webkit-transform":"transform",u=e.safari?"WebkitTransformOrigin":"transformOrigin";o.fn.okzoom=function(e){return e=o.extend({},o.fn.okzoom.defaults,e),this.each(function(){var t={};t.options=e,t.$el=o(this),t.el=this,t.listener=document.createElement("div"),t.$listener=o(t.listener).addClass("ok-listener").css({position:"absolute",zIndex:1e4}),o("body").append(t.$listener);var i,n=document.createElement("div");if(n.id="ok-loupe",n.style.position="absolute",n.style.backgroundRepeat="no-repeat",n.style.pointerEvents="none",n.style.opacity=0,n.style.zIndex=7879,o("body").append(n),t.loupe=n,t.$el.data("okzoom",t),t.options=e,a?(t.$el.bind("touchstart",(i=t,function(e){console.log("TS",e),e.preventDefault(),o.fn.okzoom.build(i,e.originalEvent.touches[0])})),t.$el.bind("touchmove",function(e){return function(t){console.log("TM"),t.preventDefault(),o.fn.okzoom.mousemove(e,t.originalEvent.touches[0])}}(t)),t.$el.bind("touchend",function(e){return function(t){console.log("TE"),t.preventDefault(),o.fn.okzoom.mouseout(e,t)}}(t))):(o(t.el).bind("mouseover",function(e){return function(t){o.fn.okzoom.build(e,t)}}(t)),t.$listener.bind("mousemove",function(e){return function(t){o.fn.okzoom.mousemove(e,t)}}(t)),t.$listener.bind("mouseout",function(e){return function(t){o.fn.okzoom.mouseout(e,t)}}(t))),t.options.height=t.options.height||t.options.width,t.image_from_data=t.$el.data("okimage"),t.has_data_image=void 0!==t.image_from_data,t.timeout=null,t.has_data_image&&(t.img=new Image,t.img.src=t.image_from_data),t.msie=-1,"Microsoft Internet Explorer"==navigator.appName){var r=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(r)&&(t.msie=parseFloat(RegExp.$1))}})},o.fn.okzoom.defaults={width:150,height:null,scaleWidth:null,round:!0,background:"#fff",backgroundRepeat:"no-repeat",shadow:"0 0 5px #000",inset:0,border:0,transform:a?["scale(0)","scale(1)"]:null,transformOrigin:a?"50% 100%":"50% 50%",transitionTime:200,transitionTimingFunction:"cubic-bezier(0,0,0,1)"},o.fn.okzoom.build=function(e,t){if(e.has_data_image?e.image_from_data!=e.$el.attr("data-okimage")&&(e.image_from_data=e.$el.attr("data-okimage"),o(e.img).remove(),e.img=new Image,e.img.src=e.image_from_data):e.img=e.el,e.msie>-1&&e.msie<9&&!e.img.naturalized){if(!e.img.complete)return;!function(o){o=o||this;var e=new Image;e.el=o,e.src=o.src,o.naturalWidth=e.width,o.naturalHeight=e.height,o.naturalized=!0}(e.img)}e.offset=e.$el.offset(),e.width=e.$el.width(),e.height=e.$el.height(),e.$listener.css({display:"block",width:e.$el.outerWidth(),height:e.$el.outerHeight(),top:e.$el.offset().top,left:e.$el.offset().left}),e.options.scaleWidth?(e.naturalWidth=e.options.scaleWidth,e.naturalHeight=Math.round(e.img.naturalHeight*e.options.scaleWidth/e.img.naturalWidth)):(e.naturalWidth=e.img.naturalWidth,e.naturalHeight=e.img.naturalHeight),e.widthRatio=e.naturalWidth/e.width,e.heightRatio=e.naturalHeight/e.height,e.loupe.style.width=e.options.width+"px",e.loupe.style.height=e.options.height+"px",e.loupe.style.border=e.options.border,e.loupe.style.background=e.options.background+" url("+e.img.src+")",e.loupe.style.backgroundRepeat=e.options.backgroundRepeat,e.loupe.style.backgroundSize=e.options.scaleWidth?e.naturalWidth+"px "+e.naturalHeight+"px":"auto",e.loupe.style.borderRadius=e.loupe.style.MozBorderRadius=e.loupe.style.WebkitBorderRadius=e.options.round?"50%":0,e.loupe.style.boxShadow=e.options.shadow,e.loupe.style.opacity=0,e.options.transform&&(e.loupe.style[s]=e.options.transform[0],e.loupe.style[u]=e.options.transformOrigin,e.loupe.style[r]=l+" "+e.options.transitionTime),e.initialized=!0,o.fn.okzoom.mousemove(e,t)},o.fn.okzoom.mousemove=function(o,e){if(o.initialized){var t=o.options.width/2,i=o.options.height/2,n=a?o.options.height:i,u=void 0!==e.pageX?e.pageX:e.clientX+document.documentElement.scrollLeft,m=void 0!==e.pageY?e.pageY:e.clientY+document.documentElement.scrollTop,d=-1*Math.floor((u-o.offset.left)*o.widthRatio-t),p=-1*Math.floor((m-o.offset.top)*o.heightRatio-i);document.body.style.cursor="none",o.loupe.style.left=u-t+"px",o.loupe.style.top=m-n+"px",o.loupe.style.backgroundPosition=d+"px "+p+"px",o.loupe.style.opacity=1,o.options.transform&&(o.loupe.style[s]=o.options.transform[1],o.loupe.style[s]=o.options.transform[1],o.loupe.style[r]=l+" "+o.options.transitionTime+"ms "+o.options.transitionTimingFunction),clearTimeout(o.timeout)}},o.fn.okzoom.mouseout=function(o,e){o.options.transform?(o.loupe.style[s]=o.options.transform[0],o.timeout=setTimeout(function(){o.loupe.style.opacity=0},o.options.transitionTime)):o.loupe.style.opacity=0,o.loupe.style.background="none",o.listener.style.display="none",document.body.style.cursor="auto"}});